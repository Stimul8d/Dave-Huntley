---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Container from "@components/container.astro";

const basePath = import.meta.env.BASE_URL;
const posts = await getCollection("blog", ({ data }) => {
  return !data.draft && data.publishDate < new Date();
});

posts.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<Layout title="Blog">
  <Container>
    <div class="max-w-4xl mx-auto py-16">
      <h1 class="text-4xl font-bold mb-8">Blog</h1>
      <div class="grid gap-8">
        {posts.map((post) => (
          <article class="group">
            <a href={`${basePath}/blog/${post.slug}`} class="block">
              <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow overflow-hidden">
                <div class="md:flex">
                  {post.data.image && (
                    <div class="md:flex-shrink-0">
                      <img
                        src={post.data.image.src}
                        alt={post.data.image.alt}
                        class="h-48 w-full md:h-full md:w-48 object-cover"
                      />
                    </div>
                  )}
                  <div class="p-6">
                    <span class="text-blue-600 font-medium text-sm">
                      {post.data.category}
                    </span>
                    
                    <h2 class="text-xl font-bold mt-2 group-hover:text-blue-600 transition-colors">
                      {post.data.title}
                    </h2>
                    
                    <p class="text-slate-600 mt-2 line-clamp-2">
                      {post.data.summary}
                    </p>

                    <div class="flex flex-wrap gap-2 mt-4">
                      {post.data.tags.map((tag) => (
                        <span class="text-sm text-slate-500">#{tag}</span>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            </a>
          </article>
        ))}
      </div>
    </div>
  </Container>
</Layout>